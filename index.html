<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flight Booking Details</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- LeafletJS for Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* Custom styles for the page */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        /* Styling for the map container */
        #map { 
            height: 100vh; 
            width: 100vw;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 10;
            background-color: #1a202c; /* fallback */
        }

        /* Class to control visibility of the booking section */
        #booking-section {
            transition: opacity 0.8s ease-in-out, transform 0.8s ease-in-out;
            opacity: 0;
            transform: translateY(100px);
            z-index: 20;
            position: relative;
            background-color: #f0f4f8;
        }
        
        #booking-section.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Styling for the animated plane icon */
        .plane-icon i {
            font-size: 28px;
            color: #facc15; /* yellow-400 */
            transition: transform 0.5s linear;
            text-shadow: 0 0 8px rgba(250, 204, 21, 0.7);
        }
        .live-plane-icon i {
             font-size: 22px;
             color: #facc15; /* yellow-400 */
             transition: transform 0.5s linear;
        }

        /* Custom styles for seat map */
        .seat {
            width: 40px;
            height: 40px;
            border: 2px solid #9ca3af; /* gray-400 */
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #4b5563; /* gray-600 */
            font-size: 12px;
        }
        .seat.available:hover {
            background-color: #dbeafe; /* blue-100 */
            border-color: #3b82f6; /* blue-500 */
        }
        .seat.selected {
            background-color: #ef4444; /* red-500 */
            color: white;
            border-color: #dc2626; /* red-600 */
        }
        .seat.booked {
            background-color: #6b7280; /* gray-500 */
            cursor: not-allowed;
            color: #d1d5db; /* gray-300 */
            border-color: #4b5563; /* gray-600 */
        }
        .seat.user-booked {
            background-color: #3b82f6; /* blue-500 */
            cursor: not-allowed;
            color: white;
            border-color: #2563eb; /* blue-600 */
        }
        
        /* Airplane shape styles */
        .airplane {
            display: flex;
            justify-content: center;
            margin-top: 2rem;
            transform: scale(0.9);
        }
        .airplane-body {
            width: 380px;
            background-color: #d1d5db;
            border: 3px solid #6b7280;
            border-radius: 40px;
            position: relative;
            padding: 30px 20px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
        }
        .airplane-body::before, .airplane-body::after {
            content: '';
            position: absolute;
            background-color: #d1d5db;
            border: 3px solid #6b7280;
            z-index: -1;
        }
        /* Nose */
        .airplane-body::before {
            width: 60px;
            height: 60px;
            left: -30px;
            top: 50%;
            transform: translateY(-50%);
            border-radius: 50%;
            border-right: none;
        }
        /* Tail */
        .airplane-body::after {
            width: 120px;
            height: 40px;
            right: -80px;
            top: 50%;
            transform: translateY(-50%);
            border-radius: 0 100% 100% 0 / 0 50% 50% 0;
            clip-path: polygon(0 0, 100% 50%, 0 100%);
        }
        .airplane-wing {
            position: absolute;
            width: 180px;
            height: 60px;
            background-color: #9ca3af;
            border: 3px solid #6b7280;
            z-index: -2;
        }
        #wing-left {
            left: 50%;
            top: 25%;
            transform: translateX(-100%) rotate(25deg);
            border-radius: 100% 20px 20px 20px;
        }
        #wing-right {
             left: 50%;
            bottom: 25%;
            transform: translateX(-100%) rotate(-25deg);
            border-radius: 100% 20px 20px 20px;
        }

        /* Payment Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: opacity 0.3s ease;
        }
        .modal-content {
            background: white;
            padding: 2.5rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        .modal-overlay:not(.hidden) .modal-content {
            transform: scale(1);
        }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Section 1: Map and Flight Path Visualization -->
    <div id="map-container" class="h-screen w-full relative">
        <div id="map"></div>
        <div class="absolute top-0 left-0 w-full p-4 sm:p-8 z-20 bg-gradient-to-b from-black/50 to-transparent">
            <div class="max-w-4xl mx-auto bg-white/90 backdrop-blur-sm p-6 rounded-2xl shadow-2xl">
                <h1 class="text-3xl font-bold text-gray-800 text-center mb-4">Explore Your Next Destination</h1>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-center">
                    <div class="relative">
                        <label for="from" class="block text-sm font-medium text-gray-600">From</label>
                        <input type="text" id="from" placeholder="e.g., Cairo" value="Cairo" class="mt-1 w-full p-3 rounded-lg border-gray-300 border shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                     <div class="relative">
                        <label for="to" class="block text-sm font-medium text-gray-600">To</label>
                        <input type="text" id="to" placeholder="e.g., Tokyo" class="mt-1 w-full p-3 rounded-lg border-gray-300 border shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <button id="show-flight-btn" class="w-full bg-blue-600 text-white font-bold p-3 rounded-lg hover:bg-blue-700 transition-colors shadow-lg md:mt-6">
                        <i class="fas fa-paper-plane mr-2"></i>Show Flight
                    </button>
                </div>
            </div>
        </div>
        <div class="absolute bottom-10 left-1/2 -translate-x-1/2 z-20 text-center">
             <div class="text-white text-lg font-semibold bg-black/50 p-3 rounded-lg animate-bounce">
                <i class="fas fa-chevron-down mr-2"></i>Scroll Down to Book Your Seat
             </div>
        </div>
    </div>
    
    <!-- Spacer div to create scroll space -->
    <div style="height: 100vh;"></div>

    <!-- Section 2: Booking Details (Appears on scroll) -->
    <div id="booking-section" class="py-16 px-4">
        <div class="max-w-6xl mx-auto bg-white p-8 rounded-2xl shadow-2xl">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold text-gray-800">Flight Seat Reservation</h2>
                <p class="text-gray-600 mt-2">Choose your preferred seat on the aircraft.</p>
                <div class="mt-4 text-xl font-semibold text-blue-600" id="flight-info">
                    Cairo (CAI) <i class="fas fa-arrow-right-long mx-2"></i> Tokyo (HND)
                </div>
            </div>

            <!-- Seat Map and Legend -->
            <div class="flex flex-col xl:flex-row gap-8 justify-center items-center">
                <!-- Legend -->
                <div class="flex flex-row xl:flex-col gap-4 items-start justify-center flex-wrap">
                     <h3 class="text-lg font-semibold text-gray-700 mb-2 w-full xl:w-auto text-center xl:text-left">Legend:</h3>
                    <div class="flex items-center gap-3"><div class="w-8 h-8 rounded-md border-2 border-gray-400"></div><span>Available</span></div>
                    <div class="flex items-center gap-3"><div class="w-8 h-8 rounded-md bg-red-500 border-2 border-red-600"></div><span>Selected</span></div>
                    <div class="flex items-center gap-3"><div class="w-8 h-8 rounded-md bg-gray-500 border-2 border-gray-600"></div><span>Booked</span></div>
                </div>
                
                <!-- Seat Map -->
                 <div class="airplane">
                    <div class="airplane-wing" id="wing-left"></div>
                    <div class="airplane-wing" id="wing-right"></div>
                    <div class="airplane-body">
                         <div id="seat-map" class="grid grid-cols-7 gap-x-4 gap-y-3 relative">
                            <div class="absolute top-1/2 -translate-y-1/2 -left-8 text-gray-500 font-bold -rotate-90 origin-center tracking-widest text-sm">EXIT</div>
                            <div class="absolute top-1/2 -translate-y-1/2 -right-8 text-gray-500 font-bold -rotate-90 origin-center tracking-widest text-sm">EXIT</div>
                            <!-- Seats will be generated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Booking Summary and Action -->
            <div class="mt-12 border-t pt-8 text-center">
                 <h3 class="text-2xl font-bold text-gray-800">Booking Summary</h3>
                 <div id="booking-summary" class="mt-4 text-gray-600 text-lg min-h-[28px]">
                    Select a seat to see details.
                 </div>
                 <button id="book-now-btn" class="mt-6 bg-green-600 text-white font-bold py-3 px-12 text-lg rounded-lg hover:bg-green-700 transition-colors shadow-lg disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>
                     Book Now
                 </button>
            </div>
        </div>
    </div>
    
    <!-- Payment Modal -->
    <div id="payment-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Confirm Your Payment</h2>
                <button id="close-payment-modal" class="text-gray-500 hover:text-gray-800">&times;</button>
            </div>
            
            <div class="bg-gray-100 p-4 rounded-lg mb-6">
                <h3 class="font-semibold text-gray-700 mb-2">Order Summary</h3>
                <div class="flex justify-between">
                    <span class="text-gray-600">Selected Seats:</span>
                    <span id="summary-seats" class="font-bold text-gray-800"></span>
                </div>
                <div class="flex justify-between mt-2 pt-2 border-t">
                    <span class="text-gray-600 text-lg">Total Amount:</span>
                    <span id="summary-total" class="font-bold text-blue-600 text-lg"></span>
                </div>
            </div>

            <!-- Payment Method -->
            <div id="card-details">
                <h3 class="font-semibold text-gray-700 mb-4">Credit Card Details</h3>
                <div class="space-y-4">
                    <input type="text" placeholder="Cardholder Name" class="w-full p-3 rounded-lg border-gray-300 border" required>
                    <input type="text" placeholder="Card Number (e.g., 1234 5678 9101 1121)" class="w-full p-3 rounded-lg border-gray-300 border" required>
                    <div class="grid grid-cols-2 gap-4">
                        <input type="text" placeholder="Expiry Date (MM/YY)" class="w-full p-3 rounded-lg border-gray-300 border" required>
                        <input type="text" placeholder="CVV" class="w-full p-3 rounded-lg border-gray-300 border" required>
                    </div>
                </div>
            </div>

            <button id="confirm-payment-btn" class="mt-8 w-full bg-blue-600 text-white font-bold p-4 rounded-lg hover:bg-blue-700 transition-colors shadow-lg">
                Confirm and Pay
            </button>
        </div>
    </div>
    
    <!-- Receipt Modal -->
    <div id="receipt-modal" class="modal-overlay hidden">
        <div class="modal-content text-center">
             <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i class="fas fa-check text-green-500 text-4xl"></i>
             </div>
             <h2 class="text-2xl font-bold text-gray-800 mb-2">Booking Confirmed!</h2>
             <p class="text-gray-600 mb-6">Your payment was successful and your seats are reserved.</p>
             <div class="bg-gray-100 p-4 rounded-lg text-left space-y-2">
                 <div class="flex justify-between"><span class="text-gray-600">Transaction ID:</span> <strong id="receipt-tid"></strong></div>
                 <div class="flex justify-between"><span class="text-gray-600">Flight:</span> <strong id="receipt-flight"></strong></div>
                 <div class="flex justify-between"><span class="text-gray-600">Seats:</span> <strong id="receipt-seats"></strong></div>
                 <div class="flex justify-between border-t pt-2 mt-2"><span class="text-gray-600">Total Paid:</span> <strong id="receipt-total" class="text-blue-600"></strong></div>
             </div>
             <button id="close-receipt-modal" class="mt-8 w-full bg-gray-700 text-white font-bold p-3 rounded-lg hover:bg-gray-800 transition">Close</button>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- MAP INITIALIZATION ---
            const map = L.map('map', { zoomControl: false }).setView([20, 0], 2);
            L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',
                maxZoom: 20
            }).addTo(map);

            let userPlaneMarker = null;
            let userFlightPath = null;
            let userAnimationFrameId;

            const cities = {
                'cairo': { lat: 30.0444, lng: 31.2357, code: 'CAI' },
                'tokyo': { lat: 35.6895, lng: 139.6917, code: 'HND' },
                'new york': { lat: 40.7128, lng: -74.0060, code: 'JFK' },
                'london': { lat: 51.5074, lng: -0.1278, code: 'LHR' },
                'paris': { lat: 48.8566, lng: 2.3522, code: 'CDG' },
                'sydney': { lat: -33.8688, lng: 151.2093, code: 'SYD' },
                'dubai': { lat: 25.276987, lng: 55.296249, code: 'DXB' },
                'beijing': { lat: 39.9042, lng: 116.4074, code: 'PEK' },
                'los angeles': { lat: 34.0522, lng: -118.2437, code: 'LAX' },
                'singapore': { lat: 1.3521, lng: 103.8198, code: 'SIN' },
            };

            const userPlaneIcon = L.divIcon({
                html: '<i class="fas fa-plane"></i>',
                className: 'plane-icon',
                iconSize: [28, 28],
                iconAnchor: [14, 14]
            });

            // --- LIVE FLIGHT TRACKER ---
            let livePlaneMarkers = [];
            const liveFlights = [
                { from: 'london', to: 'new york' }, { from: 'dubai', to: 'singapore' },
                { from: 'sydney', to: 'los angeles' }, { from: 'beijing', to: 'paris' },
                { from: 'cairo', to: 'london' }, { from: 'tokyo', to: 'sydney' },
                { from: 'new york', to: 'los angeles' }, { from: 'paris', to: 'dubai' },
                { from: 'singapore', to: 'tokyo' }, { from: 'los angeles', to: 'beijing' },
                { from: 'new york', to: 'paris' }, { from: 'london', to: 'dubai' },
                { from: 'cairo', to: 'beijing' }, { from: 'sydney', to: 'singapore' },
                { from: 'dubai', to: 'new york' }, { from: 'paris', to: 'cairo' }
            ];

            const livePlaneIcon = L.divIcon({
                html: '<i class="fas fa-plane"></i>',
                className: 'live-plane-icon',
                iconSize: [22, 22],
                iconAnchor: [11, 11]
            });

            function setupLiveTracker() {
                liveFlights.forEach(flight => {
                    const fromCity = cities[flight.from];
                    const toCity = cities[flight.to];
                    if (fromCity && toCity) {
                        const latlngs = [ [fromCity.lat, fromCity.lng], [toCity.lat, toCity.lng] ];
                        const marker = L.marker(latlngs[0], { icon: livePlaneIcon }).addTo(map);
                        const path = L.polyline([], { color: 'rgba(250, 204, 21, 0.6)', weight: 2 }).addTo(map);
                        livePlaneMarkers.push({
                            marker: marker,
                            path: path,
                            startPoint: L.latLng(latlngs[0]),
                            endPoint: L.latLng(latlngs[1]),
                            startTime: performance.now() - Math.random() * 20000,
                            duration: 20000 + Math.random() * 15000
                        });
                    }
                });
            }

            function liveAnimationLoop(currentTime) {
                livePlaneMarkers.forEach(plane => {
                    const elapsed = currentTime - plane.startTime;
                    let progress = elapsed / plane.duration;

                    if (progress >= 1) {
                        progress = 1; // Cap progress at 1
                        plane.path.setLatLngs([]); // Clear path
                        plane.startTime = currentTime; // Restart flight
                    }

                    const newLat = plane.startPoint.lat + (plane.endPoint.lat - plane.startPoint.lat) * progress;
                    const newLng = plane.startPoint.lng + (plane.endPoint.lng - plane.startPoint.lng) * progress;
                    
                    const newLatLng = [newLat, newLng];
                    plane.marker.setLatLng(newLatLng);
                    
                    if(progress > 0) plane.path.addLatLng(newLatLng);

                    const pathPoints = plane.path.getLatLngs();
                    if (pathPoints.length > 30) {
                        pathPoints.shift();
                        plane.path.setLatLngs(pathPoints);
                    }

                    const rotation = Math.atan2(plane.endPoint.lat - plane.startPoint.lat, plane.endPoint.lng - plane.startPoint.lng) * 180 / Math.PI;
                    const iconElement = plane.marker.getElement()?.querySelector('.fa-plane');
                    if (iconElement) iconElement.style.transform = `rotate(${rotation + 45}deg)`;
                });
                requestAnimationFrame(liveAnimationLoop);
            }

            // --- USER FLIGHT ANIMATION ---
            function animateUserPlane(path) {
                let startTime = performance.now();
                const duration = 8000; 
                function animate(currentTime) {
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    if (userPlaneMarker && path) {
                        const latLngs = path.getLatLngs();
                        const startPoint = L.latLng(latLngs[0]);
                        const endPoint = L.latLng(latLngs[1]);
                        const newLat = startPoint.lat + (endPoint.lat - startPoint.lat) * progress;
                        const newLng = startPoint.lng + (endPoint.lng - startPoint.lng) * progress;
                        userPlaneMarker.setLatLng([newLat, newLng]);
                        
                        const rotation = Math.atan2(endPoint.lat - startPoint.lat, endPoint.lng - startPoint.lng) * 180 / Math.PI;
                        const iconElement = userPlaneMarker.getElement()?.querySelector('.fa-plane');
                        if(iconElement) iconElement.style.transform = `rotate(${rotation + 45}deg)`;
                    }
                    if (progress < 1) userAnimationFrameId = requestAnimationFrame(animate);
                }
                cancelAnimationFrame(userAnimationFrameId);
                userAnimationFrameId = requestAnimationFrame(animate);
            }

            document.getElementById('show-flight-btn').addEventListener('click', () => {
                const fromCityName = document.getElementById('from').value.toLowerCase().trim();
                const toCityName = document.getElementById('to').value.toLowerCase().trim();
                const fromCity = cities[fromCityName];
                const toCity = cities[toCityName];

                if (fromCity && toCity) {
                    if (userPlaneMarker) map.removeLayer(userPlaneMarker);
                    if (userFlightPath) map.removeLayer(userFlightPath);

                    const latlngs = [[fromCity.lat, fromCity.lng], [toCity.lat, toCity.lng]];
                    userFlightPath = L.polyline(latlngs, { color: '#facc15', weight: 3, dashArray: '10, 10' }).addTo(map);
                    userPlaneMarker = L.marker(latlngs[0], { icon: userPlaneIcon, zIndexOffset: 1000 }).addTo(map);

                    map.fitBounds(userFlightPath.getBounds().pad(0.5));
                    animateUserPlane(userFlightPath);

                    document.getElementById('flight-info').innerHTML = 
                        `${fromCityName.charAt(0).toUpperCase() + fromCityName.slice(1)} (${fromCity.code}) 
                         <i class="fas fa-arrow-right-long mx-2"></i> 
                         ${toCityName.charAt(0).toUpperCase() + toCityName.slice(1)} (${toCity.code})`;
                } else {
                    alert('Could not find one or both cities. Please try again from the available list: Cairo, Tokyo, New York, London, Paris, Sydney, Dubai, Beijing, Los Angeles, Singapore.');
                }
            });

            // --- SCROLL ANIMATION ---
            const bookingSection = document.getElementById('booking-section');
            window.addEventListener('scroll', () => {
                bookingSection.classList.toggle('visible', window.scrollY > window.innerHeight / 2);
            });

            // --- SEAT BOOKING LOGIC ---
            const seatMap = document.getElementById('seat-map');
            const bookingSummary = document.getElementById('booking-summary');
            const bookNowBtn = document.getElementById('book-now-btn');
            const seatPrice = 20000;
            
            const rows = 15;
            const seatsPerRow = ['A', 'B', 'C', null, 'D', 'E', 'F'];
            let selectedSeats = [];
            
            // Generate seats
            for (let i = 1; i <= rows; i++) {
                seatsPerRow.forEach(seatLetter => {
                    if (seatLetter === null) {
                        const aisle = document.createElement('div');
                        aisle.textContent = i;
                        aisle.classList.add('flex', 'items-center', 'justify-center', 'text-gray-500', 'font-semibold', 'text-sm');
                        seatMap.appendChild(aisle);
                        return;
                    }
                    const seat = document.createElement('div');
                    const seatId = `${i}${seatLetter}`;
                    seat.dataset.seatId = seatId;
                    seat.classList.add('seat');
                    seat.textContent = seatId;

                    if (Math.random() > 0.8) {
                        seat.classList.add('booked');
                    } else {
                        seat.classList.add('available');
                        seat.addEventListener('click', () => toggleSeatSelection(seat, seatId));
                    }
                    seatMap.appendChild(seat);
                });
            }

            function toggleSeatSelection(seat, seatId) {
                seat.classList.toggle('selected');
                if(seat.classList.contains('selected')) {
                    selectedSeats.push(seatId);
                } else {
                    selectedSeats = selectedSeats.filter(s => s !== seatId);
                }
                updateBookingSummary();
            }

            function updateBookingSummary() {
                bookNowBtn.disabled = selectedSeats.length === 0;
                if (selectedSeats.length === 0) {
                    bookingSummary.textContent = 'Select a seat to see details.';
                } else {
                    selectedSeats.sort((a, b) => parseInt(a) - parseInt(b) || a.slice(-1).localeCompare(b.slice(-1)));
                    const totalPrice = (selectedSeats.length * seatPrice).toLocaleString('en-US');
                    bookingSummary.innerHTML = `You have selected <span class="font-bold text-blue-600">${selectedSeats.length} seat(s)</span> for a total of <span class="font-bold text-blue-600">EGP ${totalPrice}</span>.`;
                }
            }

            // --- PAYMENT MODAL LOGIC ---
            const paymentModal = document.getElementById('payment-modal');
            const receiptModal = document.getElementById('receipt-modal');

            bookNowBtn.addEventListener('click', () => {
                const totalPrice = (selectedSeats.length * seatPrice).toLocaleString('en-US');
                document.getElementById('summary-seats').textContent = selectedSeats.join(', ');
                document.getElementById('summary-total').textContent = `EGP ${totalPrice}`;
                paymentModal.classList.remove('hidden');
            });

            document.getElementById('close-payment-modal').addEventListener('click', () => {
                paymentModal.classList.add('hidden');
            });

            document.getElementById('confirm-payment-btn').addEventListener('click', () => {
                const btn = document.getElementById('confirm-payment-btn');
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Processing...';
                
                // Simulate backend processing
                setTimeout(() => {
                    paymentModal.classList.add('hidden');
                    
                    const totalPrice = (selectedSeats.length * seatPrice).toLocaleString('en-US');
                    document.getElementById('receipt-tid').textContent = `TXN${Date.now()}`;
                    document.getElementById('receipt-flight').textContent = document.getElementById('flight-info').textContent;
                    document.getElementById('receipt-seats').textContent = selectedSeats.join(', ');
                    document.getElementById('receipt-total').textContent = `EGP ${totalPrice}`;
                    receiptModal.classList.remove('hidden');

                    // Finalize booking
                    selectedSeats.forEach(seatId => {
                        const seatEl = document.querySelector(`.seat[data-seat-id="${seatId}"]`);
                        if(seatEl){
                            seatEl.classList.remove('selected', 'available');
                            seatEl.classList.add('user-booked');
                            seatEl.replaceWith(seatEl.cloneNode(true)); // Remove event listeners
                        }
                    });

                    selectedSeats = [];
                    updateBookingSummary();

                    btn.disabled = false;
                    btn.innerHTML = 'Confirm and Pay';

                }, 2000);
            });
            
             document.getElementById('close-receipt-modal').addEventListener('click', () => {
                receiptModal.classList.add('hidden');
            });

            // Initial setup
            setupLiveTracker();
            requestAnimationFrame(liveAnimationLoop);
            document.getElementById('show-flight-btn').click();
        });
    </script>
</body>
</html>



